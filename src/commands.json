{
    "welcome": {
        "message": "This is a CLI prototype for MAAS Anvil. This is a terminal emulator with fake data - only commands which are part of this prototype will work.  \nType 'help' to get a list of all available commands.\n"
    },
    "globalVariables": {
        "isVaultDeployed": "false",
        "isOfferMade": "false",
        "isVaultEnabled": "false",
        "isSnapDaemonSet": "false",
        "joinNodeName": "",
        "isBootstrapped": "false"
    },
    "commands": {
        "maas-anvil": {
            "description": "Anvil is a MAAS installer for MAAS charms.\r\nTo get started with a single node, all-in-one MAAS installation, start with initializing the local node. Once the local node has been initialized, run the bootstrap process to get a live MAAS deployment.",
            "subcommands": {
                "cluster": {
                    "description": "Manage the MAAS Cluster",
                    "subcommands": {
                        "join": {
                            "description": "Join node to the cluster.",
                            "flags": {
                                "--role": {
                                    "type": "string",
                                    "aliases": ["-r"],
                                    "description": "Specify which roles the node will be assigned in the cluster.",
                                    "required": true
                                },
                                "--token": {
                                    "type": "string",
                                    "description": "Join token",
                                    "required": true
                                },
                                "--accept-defaults": {
                                    "type": "string",
                                    "aliases": ["-a"],
                                    "description": " Accept all defaults."
                                }
                            },
                            "action": [
                                {
                                    "if": "flags['--role'] === 'vault'",
                                    "then": [
                                        {
                                            "type": "spinner",
                                            "texts": [
                                                "Adding node to Sunbeam cluster ...",
                                                "Registering machine user using token ...",
                                                "Adding machine to Juju model ...",
                                                "Initializing Terraform from provider mirror ...",
                                                "Deploying Vault ...",
                                                "Adding Vault unit to machine ..."
                                            ],

                                            "duration": 10000
                                        },
                                        "Node joined cluster with roles: vault"
                                    ],
                                    "else": "This prototype doesn't allow 'joining' with roles other than vault."
                                }
                            ]
                        }
                    }
                },
                "inspect": {
                    "description": "Inspect the maas-anvil installation.",
                    "action": "This command is not part of this prototype"
                },
                "manifest": {
                    "description": "Manage manifests (read-only commands)",
                    "action": "This command is not part of this prototype"
                },
                "prepare-node-script": {
                    "description": "Generate script to prepare a node for Anvil use.",
                    "action": "This command is not part of this prototype"
                },
                "enable": {
                    "description": "Enable plugins for MAAS Anvil to use.",
                    "action": [
                        {
                            "if": "args[0] === 'vault'",
                            "then": [
                                {
                                    "setVariable": "isVaultEnabled",
                                    "value": "true"
                                },
                                "Vault has been enabled!"
                            ],
                            "else": "Unknown plugin {{args[0]}}."
                        }
                    ]
                }
            },
            "flags": {
                "--quiet": {
                    "type": "boolean",
                    "aliases": ["-q"]
                },
                "--verbose": {
                    "type": "boolean",
                    "aliases": ["-v"]
                }
            }
        },
        "juju": {
            "description": "Juju",
            "subcommands": {
                "deploy": {
                    "description": "Deploy a charm.",
                    "action": [
                        {
                            "if": "args[0] === 'vault'",
                            "then": [
                                {
                                    "setVariable": "isVaultDeployed",
                                    "value": "true"
                                },
                                "Deployed 'vault' from charm-hub charm 'vault', revision 351 in channel 1.8/stable on ubuntu@22.04/stable"
                            ],
                            "else": "This prototype doesn't allow 'deploying' charms other than vault."
                        }
                    ]
                },
                "relate": {
                    "description": "Relate two charms.",
                    "action": [
                        {
                            "if": "globalVariables.isVaultDeployed === 'true' && args[0] === 'maas-region:vault' && args[1] === 'admin/test.vault-offer'",
                            "then": "Successfully related vault secrets with MAAS Anvil secrets.",
                            "else": "Unable to relate."
                        }
                    ]
                },
                "offer": {
                    "description": "Creating an offer so it is available to the Anvil Juju model",
                    "action": [
                        {
                            "if": "args[0] === 'vault:secrets' && args[1] === 'vault-offer'",
                            "then": [
                                {
                                    "setVariable": "isOfferMade",
                                    "value": "true"
                                },
                                "Application 'vault' endpoints [secrets] available at 'admin/test.vault-offer'"
                            ],
                            "else": "This prototype only allows for creating an offer for vault:secrets with the name vault-offer."
                        }
                    ]
                },
                "show-offer": {
                    "description": "Show all available offers",
                    "action": [
                        {
                            "if": "globalVariables.isOfferMade === 'true'",
                            "then": [
                                {
                                    "data": [
                                        ["Store", "URL", "Access", "Description", "Endpoint", "Interface", "Role"],
                                        [
                                            "localhost-localhost",
                                            "admin/test.vault-offer",
                                            "Vault secures, stores, and tightly controls secrets.",
                                            "secrets",
                                            "vault-kv",
                                            "provider",
                                            "admin"
                                        ]
                                    ],
                                    "format": "table"
                                }
                            ],
                            "else": "No available offers."
                        }
                    ]
                }
            }
        }
    }
}
